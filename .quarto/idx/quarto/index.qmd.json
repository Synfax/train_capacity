{"title":"combined_scores <- original_values %>%","markdown":{"yaml":{"format":{"closeread-html":{"grid":{"body-width":"900px"},"theme":"zephr","page-layout":"article","remove-header-space":false,"css":["index.css","nav_fixes.css"],"image":"index_images/main.png","cr-section":{"layout":"overlay-left"}}}},"headingText":"combined_scores <- original_values %>%","containsRefs":false,"markdown":"\n\n```{=html}\n<script>\nfunction modifyMainDiv() {\n  console.log('blue');\n  const mainDiv = document.getElementById('quarto-document-content');\n  if (mainDiv) {\n    console.log('found');\n    mainDiv.classList.remove('column-body');\n    mainDiv.classList.add('column-page-right');\n    // You can add more class modifications here\n  }\n}\n\n// This function will be called by the script in the Quarto document\nmodifyMainDiv();\n</script>\n```\n```{r, message=FALSE, warning=FALSE}\n\nlibrary(tidyverse)\nlibrary(sf)\nlibrary(leaflet)\nlibrary(shiny)\nlibrary(htmlwidgets)\nlibrary(reactablefmtr)\n\nlocations <- readRDS('../r_objects/locations.Rdata')\nsource('../r/constants.r')\n\nsource('../r/theme.r')\nsource('../r/graphs.r')\nsource('../r/prepare_index_page.r')\nsource('../r/transform.r')\n\ntransformed_scores <- readRDS('../r_objects/transformed_scores.Rdata')\noriginal_values <- readRDS('../r_objects/station_rankings.Rdata')\n\n#   left_join(transformed_scores, by = 'station') %>%\n#   arrange(desc(score)) %>%\n#   slice_head(n = 10) %>%\n#   mutate(across(where(is.numeric), .fns = function(x) round(x, 2) )) %>%\n#   mutate(rank = row_number())\n\n\ntransformed_scores <- readRDS('../r_objects/transformed_scores.Rdata') %>%\n  remove_null_weighted_cols() %>%\n  as.data.frame() %>%\n  slice_head(n = 10) %>%\n  mutate(across(where(is.numeric), .fns = function(x) round(x, 2) )) %>%\n  mutate(rank = row_number()) \n\nsan_station <- function(x) {\n  return( str_replace(x, ' ', '_') )\n}\n\n# translations = c(\n#   'grz_nrz_pc' = 'Zoning suitability',\n#   'capacity_delta' = 'Potential new homes',\n#   'average_peak_service_freq' = 'Train frequency',\n#   'average_peak_service_cap' = 'Available train capacity',\n#   'walkability_score' = 'Local services',\n#   'distance' = 'Distance to CBD',\n#   'n_bus_tram' = 'Other transport infrastructure'\n# )\n\n# compact_data_bars <- function(data, fill_color = \"#00bfc4\", inside_color = \"white\", outside_color = \"black\", force_outside = FALSE, ...) {\n#   orig_formatter <- reactablefmtr::data_bars(data, fill_color = fill_color, force_outside = force_outside, ...)\n#   \n#   function(value, index, name) {\n#     bar <- orig_formatter(value, index, name)\n#     script <- sprintf(\"\n#       const b = this.querySelector('.bar-cell');\n#       if (b) {\n#         const t = b.querySelector('span');\n#         if (t) t.style.color = (b.querySelector('.bar').offsetWidth < b.offsetWidth && %s) ? '%s' : '%s';\n#       }\n#     \", !force_outside, inside_color, outside_color)\n#     \n#     tagList(bar, tags$script(HTML(script)))\n#   }\n# }\n\ntranslations <- translations <- gsub(\"\\\\s*\\\\([^)]+\\\\)\", \"\", translations)\n\n\nprintScores <- function(r) {\n  \n  transformed_scores %>% \n  filter(rank == r) %>%\n  pivot_longer(-station) %>%\n  select(-station) %>%\n  filter(!(name %in% c('score','rank'))) %>%\n  mutate(name = translations[name]) %>%\n  reactable(\n            class = \"pageinforeactable\",\n            columns = list(\n              'name' = colDef(name = 'Metric'),\n              'value' = colDef(name = \"Score\",\n                             cell = data_bars(.,\n                                              text_position = 'above',\n                                              fill_color = '#1B5E20',\n                                              text_color = 'black',\n                                              background = 'opaque',\n                                              fill_opacity = 1,\n                                              bar_height = 24,\n                                              bold_text = T))\n            )\n            \n            ) %>%\n  return()\n  \n}\n\n```\n\n::: column-body\n\n\\\n\n# Train Station Upzoning Rankings: Executive Summary\n\n\\\n\nMelbourne is going to have to make some choices soon about where to build more housing.\n\nLocating new dwellings nearby to train stations as a form of Transit Oriented Development has emerged as a favoured solution by policymakers, with recent applications in Sydney.\n\nHowever, policymakers face difficult choices in choosing which stations to upzone. For example, train stations close to the the city may be ideal for locating people near employment opportunities, although they may already be developed, or, the train line may lack spare passenger capacity. Stations further away may be less developed, although they might have poorer service frequencies or other nearby amenities.\n\nThe purpose of this report is to tackle these trade-offs by building a robust and data-driven framework to identify the train stations that are best suited for this broad upzoning.\n\n*See the full report [here](report.html \"Full Report\").*\n\n### Methodology\n\n\\\n\nFor each train station, metrics are calculated on:\n\n-   Zoning suitability (% land area)\n<!-- -   Potential number of new homes (# homes) -->\n-   Train service frequency in peak (trains per hour)\n-   Spare train line capacity in peak (# passengers)\n-   Local amenities nearby (composite index)\n-   Proximity to CBD (metres)\n-   Bus and tram frequencies (services per hour)\n\nEach metric calculated uses different units of measurement, and need to be transformed into comparable units so that a single score can be generated for each train station.\n\nThis report uses xmin-xmax scaling, which transforms each 'raw' metric into a value between zero and one. If a station receives a 'transformed' score of zero, it corresponds to the lowest value out of all stations. Likewise, a value of one represents the best out of all stations in Melbourne.\n\nThese 'transformed' scores are summed together to produce a final score for each station.\n\n::: callout-note\nThere are some restrictions placed on final rankings:\n\n-   City loop stations are excluded as they can't be upzoned further.\n\n-   Edge transfer stations (North Melbourne, South Yarra, Richmond) were excluded due to extreme outliers in the data impacting the transformation process.\n\n-   Stations further than 25km of Flinders Street are excluded as they are generally economically unfeasible to upzone.\n:::\n\nThe full methodology is contained in the full report.\n\n### Key Result: Top 10 Train Stations\n\n\\\n\n**`r transformed_scores %>% filter(rank == 1) %>% pull(station)`** was the best station out of those considered in this project.\n\nThere is a searchable table and interactive map at the foot of this document to find your own station and see where it ranks.\n\nA chart below shows the scores of the 10 highest ranked stations, with an interactive map underneath to show the spatial distribution.\n\n::: column-body\n\n## Chart\n\n```{r}\n top_10_chart()\n```\n\n\n## Map\n::: {.interactive-map}\n```{r}\n#| fig-height: 6\n\nprepare_index(returnTopTen = T, fromQuarto = T, font_size_q = '8pt', h = NULL, w = NULL)\n\n```\n:::\n\n\n:::\n\n### Key result: Distribution by LGA\n\n\\\n\nThe best stations for upzoning are not equally distributed across Melbourne.\n\nLocal government areas in the inner south east, such as Stonnington & Boroondara, have the most stations in the top 25 ranking stations.\n\nHover over the bar chart below for an interactive effect.\n:::\n\n::: column-body\n```{r}\n\ntop_stations_by_lga() \n\n```\n:::\n\n::: column-body\n# In-Depth Analysis of Top 10 Stations\n\nThis next section will step through each 10 highest ranked stations. It will include a breakdown of how its score was formed, which uses the transformed scores discussed in the methodology section. These scores are bounded between zero and one.\n\nA table below shows a *rough* guide of how to interpret the transformed scores.\n\n| Transformed Value | Interpretation |\n|-------------------|----------------|\n| 0-0.35            | Poor           |\n| 0.35 - 0.6        | Low            |\n| 0.6 - 0.8         | Good           |\n| 0.8 - 1           | Excellent      |\n\nUse a laptop or desktop for the best viewing experience. (keep scrolling!)\n:::\n\n::: cr-section\n::: {focus-on=\"cr-map1\"}\n## [`r transformed_scores$station[1]`](`r paste0('../',\"stations/\",san_station(transformed_scores$station[1]), '.html')`)\n\n###### Rank: 1\n\n###### Total Score: `r transformed_scores$score[1]` / `r sum(weights)`\n\n\\\n\n```{r}\n\nprintScores(1)\n\n```\n\nSee more information [here](`r paste0('../',\"stations/\",san_station(transformed_scores$station[1]), '.html')`).\n:::\n\n::: {focus-on=\"cr-map2\"}\n## [`r transformed_scores$station[2]`](`r paste0('../',\"stations/\",san_station(transformed_scores$station[2]), '.html')`)\n\n###### Rank: 2\n\n###### Total Score: `r transformed_scores$score[2]` / `r sum(weights)`\n\n\\\n\n```{r}\n\nprintScores(2)\n\n```\n\nSee more information [here](`r paste0('../',\"stations/\",san_station(transformed_scores$station[2]), '.html')`).\n:::\n\n::: {focus-on=\"cr-map3\"}\n## [`r transformed_scores$station[3]`](`r paste0('../',\"stations/\",san_station(transformed_scores$station[3]), '.html')`)\n\n###### Rank: 3\n\n###### Total Score: `r transformed_scores$score[3]` / `r sum(weights)`\n\n\\\n\n```{r}\n\nprintScores(3)\n\n```\n\nSee more information [here](`r paste0('../',\"stations/\",san_station(transformed_scores$station[3]), '.html')`).\n:::\n\n::: {focus-on=\"cr-map4\"}\n## [`r transformed_scores$station[4]`](`r paste0('../',\"stations/\",san_station(transformed_scores$station[4]), '.html')`)\n\n###### Rank: 4\n\n###### Total Score: `r transformed_scores$score[4]` / `r sum(weights)`\n\n\\\n\n```{r}\n\nprintScores(4)\n\n```\n\nSee more information [here](`r paste0('../',\"stations/\",san_station(transformed_scores$station[4]), '.html')`).\n:::\n\n::: {focus-on=\"cr-map5\"}\n## [`r transformed_scores$station[5]`](`r paste0('../',\"stations/\",san_station(transformed_scores$station[5]), '.html')`)\n\n###### Rank: 5\n\n###### Total Score: `r transformed_scores$score[5]` / `r sum(weights)`\n\n\\\n\n```{r}\n\nprintScores(5)\n\n```\n\nSee more information [here](`r paste0('../',\"stations/\",san_station(transformed_scores$station[5]), '.html')`).\n:::\n\n::: {focus-on=\"cr-map6\"}\n## [`r transformed_scores$station[6]`](`r paste0('../',\"stations/\",san_station(transformed_scores$station[6]), '.html')`)\n\n###### Rank: 6\n\n###### Total Score: `r transformed_scores$score[6]` / `r sum(weights)`\n\n\\\n\n```{r}\n\nprintScores(6)\n\n```\n\nSee more information [here](`r paste0('../',\"stations/\",san_station(transformed_scores$station[6]), '.html')`).\n:::\n\n::: {focus-on=\"cr-map7\"}\n## [`r transformed_scores$station[7]`](`r paste0('../',\"stations/\",san_station(transformed_scores$station[7]), '.html')`)\n\n###### Rank: 7\n\n###### Total Score: `r transformed_scores$score[7]` / `r sum(weights)`\n\n\\\n\n```{r}\n\nprintScores(7)\n\n```\n\nSee more information [here](`r paste0('../',\"stations/\",san_station(transformed_scores$station[7]), '.html')`).\n:::\n\n::: {focus-on=\"cr-map8\"}\n## [`r transformed_scores$station[8]`](`r paste0('../',\"stations/\",san_station(transformed_scores$station[8]), '.html')`)\n\n###### Rank: 8\n\n###### Total Score: `r transformed_scores$score[8]` / `r sum(weights)`\n\n\\\n\n```{r}\n\nprintScores(8)\n\n```\n\nSee more information [here](%60r%20paste0('stations/',san_station(transformed_scores$station%5B8%5D),'/quarto/',san_station(transformed_scores$station%5B8%5D),'.html')%20%60).\n:::\n\n::: {focus-on=\"cr-map9\"}\n## [`r transformed_scores$station[9]`](`r paste0('../',\"stations/\",san_station(transformed_scores$station[9]), '.html')`)\n\n###### Rank: 9\n\n###### Total Score: `r transformed_scores$score[9]` / `r sum(weights)`\n\n\\\n\n```{r}\n\nprintScores(9)\n\n```\n\nSee more information [here](`r paste0('../',\"stations/\",san_station(transformed_scores$station[9]), '.html')`).\n:::\n\n::: {focus-on=\"cr-map10\"}\n## [`r transformed_scores$station[10]`](`r paste0('../',\"stations/\",san_station(transformed_scores$station[10]), '.html')`)\n\n###### Rank: 10\n\n###### Total Score: `r transformed_scores$score[10]` / `r sum(weights)`\n\n\\\n\n```{r}\n\nprintScores(10)\n\n```\n\nSee more information [here](`r paste0('../',\"stations/\",san_station(transformed_scores$station[10]), '.html')`).\n:::\n\n::: {focus-on=\"cr-click\"}\n## Clickable Map\n\nYou can find more details about your own local station by zooming in on the map and clicking on the label.\n\nAlternatively, use the searchable table below.\n\n## Searchable Table\n\n```{r}\n\n# transformed_scores %>%\n#   select(station, score) %>%\n#   reactable(theme = cyborg(),\n#             class = \"pageinforeactable\",\n#             columns = list(\n#               'station' = colDef(name = 'station'),\n#               'score' = colDef(name = \"Score\",\n#                              cell = data_bars(.,\n#                                               fill_color = 'white',\n#                                               background = 'opaque'))\n#             )\n#             \n#             )\n\n\n\n# readRDS('../r_objects/transformed_scores.Rdata') %>%\n#   as.data.frame() %>%\n#   mutate(across(where(is.numeric), ~round(.x, 2))) %>%\n#   rename(!!!translations) %>%\n#   reactable(theme = sandstone(),searchable = T, defaultSorted = \"Total Score\", defaultSortOrder = \"desc\", defaultPageSize = 10)\n\n\n df_with_links = readRDS('../r_objects/transformed_scores.Rdata')  %>%\n  as.data.frame() %>%\n  select(station) %>%\n  mutate(safe_name = gsub(\"[^a-zA-Z0-9]\", \"_\", station)) %>%\n  mutate(win_url = paste0('../stations/', safe_name, '.html')) %>%\n  select(-safe_name)\n\nreactable(df_with_links,\n          filterable = T,\n  columns = list(\n    station = colDef(\n      name = \"Station\",\n      cell = function(value, index) {\n        url <- df_with_links$win_url[index]\n        htmltools::a(href = url, value, target = \"_blank\")\n      }\n    ),\n    win_url = colDef(show = FALSE)  # Hide the URL column\n  )\n)\n\n```\n:::\n\n::: {#cr-main}\n:::\n\n::: {#cr-map1}\n:::\n\n::: {#cr-map2}\n:::\n\n::: {#cr-map3}\n:::\n\n::: {#cr-map4}\n:::\n\n::: {#cr-map5}\n:::\n\n::: {#cr-map6}\n:::\n\n::: {#cr-map7}\n:::\n\n::: {#cr-map8}\n:::\n\n::: {#cr-map9}\n:::\n\n::: {#cr-map10}\n:::\n\n::: {#cr-click}\n```{r}\n\ncolours = tribble(\n  ~group, ~ colour,\n  'Sandringham' , \"#F178AF\",\n  'CrossCity' , \"#028430\",\n  'Cran/Pak' , \"#279FD5\",\n  \"Burnley\" , \"#152C6B\",\n  \"Northern\" , \"#FFBE00\",\n  \"Eastern\" , \"#BE1014\",\n  'event' , \"#95979A\"\n)\n\nlines_dissolved <- read_sf('../shapefiles/qgis/final_map.shp') %>%\n  left_join(colours, by = 'group') \n\nvalid_stations <-  readRDS('../r_objects/transformed_scores.Rdata') %>%\n  pull(station)\n\nlocations = locations %>%\n  filter(Station_Name %in% valid_stations) %>%\n  mutate(safe_name = gsub(\"[^a-zA-Z0-9]\", \"_\", Station_Name)) %>%\n  mutate(message = \n           paste0(\n             '<div style = \\\" background-color: black; \\\">',\n             \"<p style = \\\" color: white; text-align:center ; padding: 5px; \\\" >\", Station_Name, '</p>',\n             '</div>'\n             \n           )\n  ) %>%\n  mutate(win_url = paste0('../stations/', safe_name, '.html'))\n\n\n\njs_code <- \"\nfunction(el, x, data) {\n\n    var marker = document.getElementsByClassName('my-labels');\n  for(var i=0; i < marker.length; i++){\n    (function(){\n      console.log('hello');\n      var v = data.win_url[i];\n      marker[i].addEventListener('click', function() { window.open(v);}, false);\n  }()); \n  }\n\n  var map = this;\n  \n  \n// Optional: Re-enable scrolling when mouse enters the map\nmap.on('mouseenter', function() {\n    if (!document.getElementById('cr-click').classList.contains('cr-active')) {\n        map.scrollWheelZoom.enable();\n        console.log('a');\n    }\n});\n\n// Optional: Disable scrolling again when mouse leaves the map\nmap.on('mouseleave', function() {\n    if (!document.getElementById('cr-click').classList.contains('cr-active')) {\n        map.scrollWheelZoom.disable();\n        console.log('b');\n    }\n});\n  \n  function updateMapScrolling() {\n     var crClickDiv = document.getElementById('cr-click');\n    var mapContainer = map.getContainer();\n    \n    if (crClickDiv.classList.contains('cr-active')) {\n        // Enable map interaction\n        map.scrollWheelZoom.enable();\n        map.dragging.enable();\n        map.touchZoom.enable();\n        map.doubleClickZoom.enable();\n        map.boxZoom.enable();\n        map.keyboard.enable();\n        if (map.tap) map.tap.enable();\n        mapContainer.style.pointerEvents = 'auto';\n    } else {\n        // Disable all map interaction\n        map.scrollWheelZoom.disable();\n        map.dragging.disable();\n        map.touchZoom.disable();\n        map.doubleClickZoom.disable();\n        map.boxZoom.disable();\n        map.keyboard.disable();\n        if (map.tap) map.tap.disable();\n        mapContainer.style.pointerEvents = 'none';\n    }\n  }\n  \n\n  function updateLabelVisibility() {\n   \n    var currentZoom = map.getZoom();\n   \n    var showLabelsZoomLevel = 13;\n\n    var labels = document.getElementsByClassName('my-labels');\n   \n    for (var i = 0; i < labels.length; i++) {\n      if (currentZoom >= showLabelsZoomLevel) {\n        labels[i].style.display = 'block';\n      } else {\n        labels[i].style.display = 'none';\n      }\n    }\n  }\n  \n  // Initial setup\nupdateMapScrolling();\n\n// Add event listener to check for class changes\nvar observer = new MutationObserver(function(mutations) {\n    mutations.forEach(function(mutation) {\n        if (mutation.type === 'attributes' && mutation.attributeName === 'class') {\n            updateMapScrolling();\n            console.log('cr click updated status');\n        }\n    });\n});\n\nvar crClickDiv = document.getElementById('cr-click');\nobserver.observe(crClickDiv, { attributes: true });\n\n  // Ensure the map is fully loaded before adding the event listener\n  map.whenReady(function() {\n  \n  \n \n    map.on('zoomend', function() {\n  \n      updateLabelVisibility();\n    });\n    \n    // Initial call to set correct visibility\n    updateLabelVisibility();\n  });\n}\n\n\n\n\n\n\n\"\n\nm <- leaflet(width = '100%', height = '100vh') %>%\n  leaflet::setView(lng = 144.9668, lat = -37.8181, zoom = 12) %>%\n  addPolylines(data = lines_dissolved, color = ~colour, opacity = 1) %>%\n  addTiles('https://tiles.stadiamaps.com/tiles/stamen_toner_background/{z}/{x}/{y}.png?api_key=090a847c-32a2-4e35-99a9-543ad8f4ecc8', options = tileOptions(opacity = 0.5)) %>%\n  addCircleMarkers(lng = locations$lng, lat=locations$lat, radius = 5, color = 'black', fillColor = 'black', fillOpacity = 1, opacity = 0.7) %>%\n  addLabelOnlyMarkers(lng = locations$lng,\n                      lat = locations$lat,\n                      label = lapply(locations$message, htmltools::HTML),\n                      labelOptions = labelOptions(noHide = T, clickable = T,  className = 'my-labels', direction = 'auto', textOnly = T, textsize = '10pt',\n                                                  style = list(\n                                                    'font-weight' = '800',\n                                                    'text-decoration' = 'underline',\n                                                    'text-decoration-color' = 'white',\n                                                    'margin' = '5px',\n                                                    'letter-spacing' = '0.5px'\n                                                  ))) %>%\n  htmlwidgets::onRender(js_code, data = locations) \n\nm\n\n```\n:::\n:::\n","srcMarkdownNoYaml":"\n\n```{=html}\n<script>\nfunction modifyMainDiv() {\n  console.log('blue');\n  const mainDiv = document.getElementById('quarto-document-content');\n  if (mainDiv) {\n    console.log('found');\n    mainDiv.classList.remove('column-body');\n    mainDiv.classList.add('column-page-right');\n    // You can add more class modifications here\n  }\n}\n\n// This function will be called by the script in the Quarto document\nmodifyMainDiv();\n</script>\n```\n```{r, message=FALSE, warning=FALSE}\n\nlibrary(tidyverse)\nlibrary(sf)\nlibrary(leaflet)\nlibrary(shiny)\nlibrary(htmlwidgets)\nlibrary(reactablefmtr)\n\nlocations <- readRDS('../r_objects/locations.Rdata')\nsource('../r/constants.r')\n\nsource('../r/theme.r')\nsource('../r/graphs.r')\nsource('../r/prepare_index_page.r')\nsource('../r/transform.r')\n\ntransformed_scores <- readRDS('../r_objects/transformed_scores.Rdata')\noriginal_values <- readRDS('../r_objects/station_rankings.Rdata')\n\n# combined_scores <- original_values %>%\n#   left_join(transformed_scores, by = 'station') %>%\n#   arrange(desc(score)) %>%\n#   slice_head(n = 10) %>%\n#   mutate(across(where(is.numeric), .fns = function(x) round(x, 2) )) %>%\n#   mutate(rank = row_number())\n\n\ntransformed_scores <- readRDS('../r_objects/transformed_scores.Rdata') %>%\n  remove_null_weighted_cols() %>%\n  as.data.frame() %>%\n  slice_head(n = 10) %>%\n  mutate(across(where(is.numeric), .fns = function(x) round(x, 2) )) %>%\n  mutate(rank = row_number()) \n\nsan_station <- function(x) {\n  return( str_replace(x, ' ', '_') )\n}\n\n# translations = c(\n#   'grz_nrz_pc' = 'Zoning suitability',\n#   'capacity_delta' = 'Potential new homes',\n#   'average_peak_service_freq' = 'Train frequency',\n#   'average_peak_service_cap' = 'Available train capacity',\n#   'walkability_score' = 'Local services',\n#   'distance' = 'Distance to CBD',\n#   'n_bus_tram' = 'Other transport infrastructure'\n# )\n\n# compact_data_bars <- function(data, fill_color = \"#00bfc4\", inside_color = \"white\", outside_color = \"black\", force_outside = FALSE, ...) {\n#   orig_formatter <- reactablefmtr::data_bars(data, fill_color = fill_color, force_outside = force_outside, ...)\n#   \n#   function(value, index, name) {\n#     bar <- orig_formatter(value, index, name)\n#     script <- sprintf(\"\n#       const b = this.querySelector('.bar-cell');\n#       if (b) {\n#         const t = b.querySelector('span');\n#         if (t) t.style.color = (b.querySelector('.bar').offsetWidth < b.offsetWidth && %s) ? '%s' : '%s';\n#       }\n#     \", !force_outside, inside_color, outside_color)\n#     \n#     tagList(bar, tags$script(HTML(script)))\n#   }\n# }\n\ntranslations <- translations <- gsub(\"\\\\s*\\\\([^)]+\\\\)\", \"\", translations)\n\n\nprintScores <- function(r) {\n  \n  transformed_scores %>% \n  filter(rank == r) %>%\n  pivot_longer(-station) %>%\n  select(-station) %>%\n  filter(!(name %in% c('score','rank'))) %>%\n  mutate(name = translations[name]) %>%\n  reactable(\n            class = \"pageinforeactable\",\n            columns = list(\n              'name' = colDef(name = 'Metric'),\n              'value' = colDef(name = \"Score\",\n                             cell = data_bars(.,\n                                              text_position = 'above',\n                                              fill_color = '#1B5E20',\n                                              text_color = 'black',\n                                              background = 'opaque',\n                                              fill_opacity = 1,\n                                              bar_height = 24,\n                                              bold_text = T))\n            )\n            \n            ) %>%\n  return()\n  \n}\n\n```\n\n::: column-body\n\n\\\n\n# Train Station Upzoning Rankings: Executive Summary\n\n\\\n\nMelbourne is going to have to make some choices soon about where to build more housing.\n\nLocating new dwellings nearby to train stations as a form of Transit Oriented Development has emerged as a favoured solution by policymakers, with recent applications in Sydney.\n\nHowever, policymakers face difficult choices in choosing which stations to upzone. For example, train stations close to the the city may be ideal for locating people near employment opportunities, although they may already be developed, or, the train line may lack spare passenger capacity. Stations further away may be less developed, although they might have poorer service frequencies or other nearby amenities.\n\nThe purpose of this report is to tackle these trade-offs by building a robust and data-driven framework to identify the train stations that are best suited for this broad upzoning.\n\n*See the full report [here](report.html \"Full Report\").*\n\n### Methodology\n\n\\\n\nFor each train station, metrics are calculated on:\n\n-   Zoning suitability (% land area)\n<!-- -   Potential number of new homes (# homes) -->\n-   Train service frequency in peak (trains per hour)\n-   Spare train line capacity in peak (# passengers)\n-   Local amenities nearby (composite index)\n-   Proximity to CBD (metres)\n-   Bus and tram frequencies (services per hour)\n\nEach metric calculated uses different units of measurement, and need to be transformed into comparable units so that a single score can be generated for each train station.\n\nThis report uses xmin-xmax scaling, which transforms each 'raw' metric into a value between zero and one. If a station receives a 'transformed' score of zero, it corresponds to the lowest value out of all stations. Likewise, a value of one represents the best out of all stations in Melbourne.\n\nThese 'transformed' scores are summed together to produce a final score for each station.\n\n::: callout-note\nThere are some restrictions placed on final rankings:\n\n-   City loop stations are excluded as they can't be upzoned further.\n\n-   Edge transfer stations (North Melbourne, South Yarra, Richmond) were excluded due to extreme outliers in the data impacting the transformation process.\n\n-   Stations further than 25km of Flinders Street are excluded as they are generally economically unfeasible to upzone.\n:::\n\nThe full methodology is contained in the full report.\n\n### Key Result: Top 10 Train Stations\n\n\\\n\n**`r transformed_scores %>% filter(rank == 1) %>% pull(station)`** was the best station out of those considered in this project.\n\nThere is a searchable table and interactive map at the foot of this document to find your own station and see where it ranks.\n\nA chart below shows the scores of the 10 highest ranked stations, with an interactive map underneath to show the spatial distribution.\n\n::: column-body\n\n## Chart\n\n```{r}\n top_10_chart()\n```\n\n\n## Map\n::: {.interactive-map}\n```{r}\n#| fig-height: 6\n\nprepare_index(returnTopTen = T, fromQuarto = T, font_size_q = '8pt', h = NULL, w = NULL)\n\n```\n:::\n\n\n:::\n\n### Key result: Distribution by LGA\n\n\\\n\nThe best stations for upzoning are not equally distributed across Melbourne.\n\nLocal government areas in the inner south east, such as Stonnington & Boroondara, have the most stations in the top 25 ranking stations.\n\nHover over the bar chart below for an interactive effect.\n:::\n\n::: column-body\n```{r}\n\ntop_stations_by_lga() \n\n```\n:::\n\n::: column-body\n# In-Depth Analysis of Top 10 Stations\n\nThis next section will step through each 10 highest ranked stations. It will include a breakdown of how its score was formed, which uses the transformed scores discussed in the methodology section. These scores are bounded between zero and one.\n\nA table below shows a *rough* guide of how to interpret the transformed scores.\n\n| Transformed Value | Interpretation |\n|-------------------|----------------|\n| 0-0.35            | Poor           |\n| 0.35 - 0.6        | Low            |\n| 0.6 - 0.8         | Good           |\n| 0.8 - 1           | Excellent      |\n\nUse a laptop or desktop for the best viewing experience. (keep scrolling!)\n:::\n\n::: cr-section\n::: {focus-on=\"cr-map1\"}\n## [`r transformed_scores$station[1]`](`r paste0('../',\"stations/\",san_station(transformed_scores$station[1]), '.html')`)\n\n###### Rank: 1\n\n###### Total Score: `r transformed_scores$score[1]` / `r sum(weights)`\n\n\\\n\n```{r}\n\nprintScores(1)\n\n```\n\nSee more information [here](`r paste0('../',\"stations/\",san_station(transformed_scores$station[1]), '.html')`).\n:::\n\n::: {focus-on=\"cr-map2\"}\n## [`r transformed_scores$station[2]`](`r paste0('../',\"stations/\",san_station(transformed_scores$station[2]), '.html')`)\n\n###### Rank: 2\n\n###### Total Score: `r transformed_scores$score[2]` / `r sum(weights)`\n\n\\\n\n```{r}\n\nprintScores(2)\n\n```\n\nSee more information [here](`r paste0('../',\"stations/\",san_station(transformed_scores$station[2]), '.html')`).\n:::\n\n::: {focus-on=\"cr-map3\"}\n## [`r transformed_scores$station[3]`](`r paste0('../',\"stations/\",san_station(transformed_scores$station[3]), '.html')`)\n\n###### Rank: 3\n\n###### Total Score: `r transformed_scores$score[3]` / `r sum(weights)`\n\n\\\n\n```{r}\n\nprintScores(3)\n\n```\n\nSee more information [here](`r paste0('../',\"stations/\",san_station(transformed_scores$station[3]), '.html')`).\n:::\n\n::: {focus-on=\"cr-map4\"}\n## [`r transformed_scores$station[4]`](`r paste0('../',\"stations/\",san_station(transformed_scores$station[4]), '.html')`)\n\n###### Rank: 4\n\n###### Total Score: `r transformed_scores$score[4]` / `r sum(weights)`\n\n\\\n\n```{r}\n\nprintScores(4)\n\n```\n\nSee more information [here](`r paste0('../',\"stations/\",san_station(transformed_scores$station[4]), '.html')`).\n:::\n\n::: {focus-on=\"cr-map5\"}\n## [`r transformed_scores$station[5]`](`r paste0('../',\"stations/\",san_station(transformed_scores$station[5]), '.html')`)\n\n###### Rank: 5\n\n###### Total Score: `r transformed_scores$score[5]` / `r sum(weights)`\n\n\\\n\n```{r}\n\nprintScores(5)\n\n```\n\nSee more information [here](`r paste0('../',\"stations/\",san_station(transformed_scores$station[5]), '.html')`).\n:::\n\n::: {focus-on=\"cr-map6\"}\n## [`r transformed_scores$station[6]`](`r paste0('../',\"stations/\",san_station(transformed_scores$station[6]), '.html')`)\n\n###### Rank: 6\n\n###### Total Score: `r transformed_scores$score[6]` / `r sum(weights)`\n\n\\\n\n```{r}\n\nprintScores(6)\n\n```\n\nSee more information [here](`r paste0('../',\"stations/\",san_station(transformed_scores$station[6]), '.html')`).\n:::\n\n::: {focus-on=\"cr-map7\"}\n## [`r transformed_scores$station[7]`](`r paste0('../',\"stations/\",san_station(transformed_scores$station[7]), '.html')`)\n\n###### Rank: 7\n\n###### Total Score: `r transformed_scores$score[7]` / `r sum(weights)`\n\n\\\n\n```{r}\n\nprintScores(7)\n\n```\n\nSee more information [here](`r paste0('../',\"stations/\",san_station(transformed_scores$station[7]), '.html')`).\n:::\n\n::: {focus-on=\"cr-map8\"}\n## [`r transformed_scores$station[8]`](`r paste0('../',\"stations/\",san_station(transformed_scores$station[8]), '.html')`)\n\n###### Rank: 8\n\n###### Total Score: `r transformed_scores$score[8]` / `r sum(weights)`\n\n\\\n\n```{r}\n\nprintScores(8)\n\n```\n\nSee more information [here](%60r%20paste0('stations/',san_station(transformed_scores$station%5B8%5D),'/quarto/',san_station(transformed_scores$station%5B8%5D),'.html')%20%60).\n:::\n\n::: {focus-on=\"cr-map9\"}\n## [`r transformed_scores$station[9]`](`r paste0('../',\"stations/\",san_station(transformed_scores$station[9]), '.html')`)\n\n###### Rank: 9\n\n###### Total Score: `r transformed_scores$score[9]` / `r sum(weights)`\n\n\\\n\n```{r}\n\nprintScores(9)\n\n```\n\nSee more information [here](`r paste0('../',\"stations/\",san_station(transformed_scores$station[9]), '.html')`).\n:::\n\n::: {focus-on=\"cr-map10\"}\n## [`r transformed_scores$station[10]`](`r paste0('../',\"stations/\",san_station(transformed_scores$station[10]), '.html')`)\n\n###### Rank: 10\n\n###### Total Score: `r transformed_scores$score[10]` / `r sum(weights)`\n\n\\\n\n```{r}\n\nprintScores(10)\n\n```\n\nSee more information [here](`r paste0('../',\"stations/\",san_station(transformed_scores$station[10]), '.html')`).\n:::\n\n::: {focus-on=\"cr-click\"}\n## Clickable Map\n\nYou can find more details about your own local station by zooming in on the map and clicking on the label.\n\nAlternatively, use the searchable table below.\n\n## Searchable Table\n\n```{r}\n\n# transformed_scores %>%\n#   select(station, score) %>%\n#   reactable(theme = cyborg(),\n#             class = \"pageinforeactable\",\n#             columns = list(\n#               'station' = colDef(name = 'station'),\n#               'score' = colDef(name = \"Score\",\n#                              cell = data_bars(.,\n#                                               fill_color = 'white',\n#                                               background = 'opaque'))\n#             )\n#             \n#             )\n\n\n\n# readRDS('../r_objects/transformed_scores.Rdata') %>%\n#   as.data.frame() %>%\n#   mutate(across(where(is.numeric), ~round(.x, 2))) %>%\n#   rename(!!!translations) %>%\n#   reactable(theme = sandstone(),searchable = T, defaultSorted = \"Total Score\", defaultSortOrder = \"desc\", defaultPageSize = 10)\n\n\n df_with_links = readRDS('../r_objects/transformed_scores.Rdata')  %>%\n  as.data.frame() %>%\n  select(station) %>%\n  mutate(safe_name = gsub(\"[^a-zA-Z0-9]\", \"_\", station)) %>%\n  mutate(win_url = paste0('../stations/', safe_name, '.html')) %>%\n  select(-safe_name)\n\nreactable(df_with_links,\n          filterable = T,\n  columns = list(\n    station = colDef(\n      name = \"Station\",\n      cell = function(value, index) {\n        url <- df_with_links$win_url[index]\n        htmltools::a(href = url, value, target = \"_blank\")\n      }\n    ),\n    win_url = colDef(show = FALSE)  # Hide the URL column\n  )\n)\n\n```\n:::\n\n::: {#cr-main}\n:::\n\n::: {#cr-map1}\n:::\n\n::: {#cr-map2}\n:::\n\n::: {#cr-map3}\n:::\n\n::: {#cr-map4}\n:::\n\n::: {#cr-map5}\n:::\n\n::: {#cr-map6}\n:::\n\n::: {#cr-map7}\n:::\n\n::: {#cr-map8}\n:::\n\n::: {#cr-map9}\n:::\n\n::: {#cr-map10}\n:::\n\n::: {#cr-click}\n```{r}\n\ncolours = tribble(\n  ~group, ~ colour,\n  'Sandringham' , \"#F178AF\",\n  'CrossCity' , \"#028430\",\n  'Cran/Pak' , \"#279FD5\",\n  \"Burnley\" , \"#152C6B\",\n  \"Northern\" , \"#FFBE00\",\n  \"Eastern\" , \"#BE1014\",\n  'event' , \"#95979A\"\n)\n\nlines_dissolved <- read_sf('../shapefiles/qgis/final_map.shp') %>%\n  left_join(colours, by = 'group') \n\nvalid_stations <-  readRDS('../r_objects/transformed_scores.Rdata') %>%\n  pull(station)\n\nlocations = locations %>%\n  filter(Station_Name %in% valid_stations) %>%\n  mutate(safe_name = gsub(\"[^a-zA-Z0-9]\", \"_\", Station_Name)) %>%\n  mutate(message = \n           paste0(\n             '<div style = \\\" background-color: black; \\\">',\n             \"<p style = \\\" color: white; text-align:center ; padding: 5px; \\\" >\", Station_Name, '</p>',\n             '</div>'\n             \n           )\n  ) %>%\n  mutate(win_url = paste0('../stations/', safe_name, '.html'))\n\n\n\njs_code <- \"\nfunction(el, x, data) {\n\n    var marker = document.getElementsByClassName('my-labels');\n  for(var i=0; i < marker.length; i++){\n    (function(){\n      console.log('hello');\n      var v = data.win_url[i];\n      marker[i].addEventListener('click', function() { window.open(v);}, false);\n  }()); \n  }\n\n  var map = this;\n  \n  \n// Optional: Re-enable scrolling when mouse enters the map\nmap.on('mouseenter', function() {\n    if (!document.getElementById('cr-click').classList.contains('cr-active')) {\n        map.scrollWheelZoom.enable();\n        console.log('a');\n    }\n});\n\n// Optional: Disable scrolling again when mouse leaves the map\nmap.on('mouseleave', function() {\n    if (!document.getElementById('cr-click').classList.contains('cr-active')) {\n        map.scrollWheelZoom.disable();\n        console.log('b');\n    }\n});\n  \n  function updateMapScrolling() {\n     var crClickDiv = document.getElementById('cr-click');\n    var mapContainer = map.getContainer();\n    \n    if (crClickDiv.classList.contains('cr-active')) {\n        // Enable map interaction\n        map.scrollWheelZoom.enable();\n        map.dragging.enable();\n        map.touchZoom.enable();\n        map.doubleClickZoom.enable();\n        map.boxZoom.enable();\n        map.keyboard.enable();\n        if (map.tap) map.tap.enable();\n        mapContainer.style.pointerEvents = 'auto';\n    } else {\n        // Disable all map interaction\n        map.scrollWheelZoom.disable();\n        map.dragging.disable();\n        map.touchZoom.disable();\n        map.doubleClickZoom.disable();\n        map.boxZoom.disable();\n        map.keyboard.disable();\n        if (map.tap) map.tap.disable();\n        mapContainer.style.pointerEvents = 'none';\n    }\n  }\n  \n\n  function updateLabelVisibility() {\n   \n    var currentZoom = map.getZoom();\n   \n    var showLabelsZoomLevel = 13;\n\n    var labels = document.getElementsByClassName('my-labels');\n   \n    for (var i = 0; i < labels.length; i++) {\n      if (currentZoom >= showLabelsZoomLevel) {\n        labels[i].style.display = 'block';\n      } else {\n        labels[i].style.display = 'none';\n      }\n    }\n  }\n  \n  // Initial setup\nupdateMapScrolling();\n\n// Add event listener to check for class changes\nvar observer = new MutationObserver(function(mutations) {\n    mutations.forEach(function(mutation) {\n        if (mutation.type === 'attributes' && mutation.attributeName === 'class') {\n            updateMapScrolling();\n            console.log('cr click updated status');\n        }\n    });\n});\n\nvar crClickDiv = document.getElementById('cr-click');\nobserver.observe(crClickDiv, { attributes: true });\n\n  // Ensure the map is fully loaded before adding the event listener\n  map.whenReady(function() {\n  \n  \n \n    map.on('zoomend', function() {\n  \n      updateLabelVisibility();\n    });\n    \n    // Initial call to set correct visibility\n    updateLabelVisibility();\n  });\n}\n\n\n\n\n\n\n\"\n\nm <- leaflet(width = '100%', height = '100vh') %>%\n  leaflet::setView(lng = 144.9668, lat = -37.8181, zoom = 12) %>%\n  addPolylines(data = lines_dissolved, color = ~colour, opacity = 1) %>%\n  addTiles('https://tiles.stadiamaps.com/tiles/stamen_toner_background/{z}/{x}/{y}.png?api_key=090a847c-32a2-4e35-99a9-543ad8f4ecc8', options = tileOptions(opacity = 0.5)) %>%\n  addCircleMarkers(lng = locations$lng, lat=locations$lat, radius = 5, color = 'black', fillColor = 'black', fillOpacity = 1, opacity = 0.7) %>%\n  addLabelOnlyMarkers(lng = locations$lng,\n                      lat = locations$lat,\n                      label = lapply(locations$message, htmltools::HTML),\n                      labelOptions = labelOptions(noHide = T, clickable = T,  className = 'my-labels', direction = 'auto', textOnly = T, textsize = '10pt',\n                                                  style = list(\n                                                    'font-weight' = '800',\n                                                    'text-decoration' = 'underline',\n                                                    'text-decoration-color' = 'white',\n                                                    'margin' = '5px',\n                                                    'letter-spacing' = '0.5px'\n                                                  ))) %>%\n  htmlwidgets::onRender(js_code, data = locations) \n\nm\n\n```\n:::\n:::\n"},"formats":{"closeread-html":{"identifier":{"display-name":"HTML","target-format":"closeread-html","base-format":"html","extension-name":"closeread"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":false,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true,"format-links":true,"shortcodes":[]},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","filters":["D:\\train_capacity\\_extensions\\qmd-lab\\closeread\\closeread.lua"],"css":["../_extensions/qmd-lab/closeread/closeread.css","index.css","nav_fixes.css"],"output-file":"index.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.3.353","page-layout":"article","revealjs-plugins":[],"grid":{"body-width":"900px"},"theme":"zephr","remove-header-space":false,"image":"index_images/main.png","cr-section":{"layout":"overlay-left"}},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}